package cui2vec_test

import (
	"fmt"
	"github.com/hscells/cui2vec"
	"os"
	"testing"
)

var cuis = []string{"C0000052", "C0000163", "C0000167", "C0000172", "C0000215", "C0000257", "C0000266", "C0000294", "C0000300", "C0000343", "C0000376", "C0000378", "C0000379", "C0000412", "C0000464", "C0000473", "C0000477", "C0000500", "C0000503", "C0000507", "C0000530", "C0000545", "C0000578", "C0000598", "C0000608", "C0000618", "C0000665", "C0000722", "C0000723", "C0000726", "C0000727", "C0000729", "C0000731", "C0000733", "C0000734", "C0000735", "C0000737", "C0000739", "C0000741", "C0000744", "C0000765", "C0000768", "C0000770", "C0000772", "C0000774", "C0000778", "C0000780", "C0000781", "C0000786", "C0000790", "C0000804", "C0000809", "C0000810", "C0000814", "C0000817", "C0000820", "C0000821", "C0000827", "C0000829", "C0000832", "C0000833", "C0000843", "C0000849", "C0000850", "C0000869", "C0000872", "C0000879", "C0000880", "C0000886", "C0000887", "C0000889", "C0000890", "C0000894", "C0000905", "C0000908", "C0000909", "C0000912", "C0000914", "C0000915", "C0000916", "C0000918", "C0000919", "C0000921", "C0000922", "C0000923", "C0000924", "C0000925", "C0000926", "C0000928", "C0000929", "C0000930", "C0000932", "C0000934", "C0000936", "C0000946", "C0000956", "C0000959", "C0000962", "C0000966", "C0000967", "C0000970", "C0000975", "C0000977", "C0000981", "C0000983", "C0000986", "C0000990", "C0000992", "C0000999", "C0001002", "C0001019", "C0001021", "C0001022", "C0001024", "C0001026", "C0001028", "C0001040", "C0001041", "C0001044", "C0001047", "C0001052", "C0001053", "C0001056", "C0001057", "C0001061", "C0001068", "C0001074", "C0001075", "C0001076", "C0001077", "C0001079", "C0001080", "C0001084", "C0001102", "C0001109", "C0001117", "C0001122", "C0001125", "C0001126", "C0001127", "C0001128", "C0001134", "C0001138", "C0001143", "C0001144", "C0001145", "C0001156", "C0001158", "C0001159", "C0001161", "C0001162", "C0001163", "C0001168", "C0001169", "C0001170", "C0001171", "C0001173", "C0001175", "C0001180", "C0001185", "C0001186", "C0001187", "C0001193", "C0001197", "C0001198", "C0001204", "C0001206", "C0001208", "C0001209", "C0001214", "C0001216", "C0001223", "C0001231", "C0001239", "C0001248", "C0001250", "C0001252", "C0001254", "C0001259", "C0001261", "C0001263", "C0001264", "C0001265", "C0001268", "C0001271", "C0001275", "C0001280", "C0001288", "C0001291", "C0001302", "C0001306", "C0001308", "C0001309", "C0001311", "C0001314", "C0001317", "C0001327", "C0001339", "C0001342", "C0001344", "C0001347", "C0001349", "C0001360", "C0001361", "C0001363", "C0001364", "C0001365", "C0001367", "C0001374", "C0001390", "C0001403", "C0001407", "C0001414", "C0001416", "C0001418", "C0001420", "C0001422", "C0001425", "C0001427", "C0001428", "C0001429", "C0001430", "C0001432", "C0001436", "C0001442", "C0001443", "C0001455", "C0001457", "C0001459", "C0001464", "C0001465", "C0001473", "C0001476", "C0001479", "C0001480", "C0001483", "C0001485", "C0001486", "C0001490", "C0001491", "C0001492", "C0001497", "C0001502", "C0001510", "C0001511", "C0001514", "C0001516", "C0001519", "C0001520", "C0001525", "C0001527", "C0001529", "C0001539", "C0001540", "C0001541", "C0001546", "C0001551", "C0001552", "C0001554", "C0001565", "C0001578", "C0001593", "C0001613", "C0001614", "C0001617", "C0001621", "C0001622", "C0001623", "C0001624", "C0001625", "C0001627", "C0001629", "C0001632", "C0001636", "C0001637", "C0001640", "C0001641", "C0001643", "C0001644", "C0001645", "C0001652", "C0001655", "C0001675", "C0001676", "C0001692", "C0001697", "C0001699", "C0001701", "C0001703", "C0001705", "C0001707", "C0001712", "C0001714", "C0001721", "C0001723", "C0001727", "C0001732", "C0001733", "C0001734", "C0001737", "C0001738", "C0001748", "C0001749", "C0001752", "C0001753", "C0001758", "C0001762", "C0001768", "C0001771", "C0001774", "C0001775", "C0001779", "C0001783", "C0001787", "C0001792", "C0001800", "C0001801", "C0001802", "C0001804", "C0001807", "C0001811", "C0001815", "C0001816", "C0001817", "C0001818", "C0001819", "C0001824", "C0001825", "C0001830", "C0001857", "C0001860", "C0001861", "C0001863", "C0001873", "C0001876", "C0001878", "C0001881", "C0001883", "C0001884", "C0001889", "C0001895", "C0001898", "C0001899", "C0001900", "C0001904", "C0001905", "C0001906", "C0001909", "C0001911", "C0001914", "C0001916", "C0001924", "C0001925", "C0001927", "C0001930", "C0001933", "C0001940", "C0001942", "C0001948", "C0001950", "C0001957", "C0001962", "C0001963", "C0001964", "C0001967", "C0001969", "C0001972", "C0001973", "C0001975", "C0001977", "C0001978", "C0001979", "C0001981", "C0001992", "C0001994", "C0002003", "C0002006", "C0002007", "C0002011", "C0002016", "C0002018", "C0002019", "C0002020", "C0002022", "C0002026", "C0002028", "C0002032", "C0002037", "C0002055", "C0002059", "C0002062", "C0002063", "C0002064", "C0002065", "C0002066", "C0002068", "C0002073", "C0002078", "C0002081", "C0002083", "C0002084", "C0002092", "C0002103", "C0002104", "C0002123", "C0002125", "C0002139", "C0002144", "C0002145", "C0002146", "C0002151", "C0002154", "C0002158", "C0002164", "C0002168", "C0002170", "C0002171", "C0002173", "C0002181", "C0002182", "C0002184", "C0002186", "C0002190", "C0002191", "C0002198", "C0002199", "C0002210", "C0002211", "C0002217", "C0002260", "C0002268", "C0002270", "C0002272", "C0002287", "C0002302", "C0002312", "C0002331", "C0002333", "C0002334", "C0002335", "C0002343", "C0002349", "C0002351", "C0002367", "C0002371", "C0002374", "C0002382", "C0002386", "C0002390", "C0002395", "C0002401", "C0002403", "C0002406", "C0002416", "C0002418", "C0002421", "C0002422", "C0002428", "C0002429", "C0002430", "C0002435", "C0002436", "C0002438", "C0002440", "C0002441", "C0002447", "C0002448", "C0002452", "C0002453", "C0002460", "C0002467", "C0002475", "C0002482", "C0002483", "C0002484", "C0002492", "C0002499", "C0002501", "C0002502", "C0002508", "C0002514", "C0002518", "C0002520", "C0002521", "C0002525", "C0002530", "C0002531", "C0002543", "C0002546", "C0002555", "C0002556", "C0002563", "C0002564", "C0002565", "C0002570", "C0002575", "C0002578", "C0002583", "C0002584", "C0002586", "C0002593", "C0002594", "C0002598", "C0002600", "C0002602", "C0002607", "C0002610", "C0002611", "C0002615", "C0002620", "C0002622", "C0002623", "C0002624", "C0002625", "C0002627", "C0002630", "C0002631", "C0002636", "C0002638", "C0002640", "C0002641", "C0002642", "C0002644", "C0002645", "C0002651", "C0002658", "C0002667", "C0002668", "C0002673", "C0002679", "C0002680", "C0002686", "C0002688", "C0002689", "C0002690", "C0002691", "C0002692", "C0002694", "C0002695", "C0002697", "C0002699", "C0002707", "C0002708", "C0002710", "C0002711", "C0002712", "C0002716", "C0002721", "C0002723", "C0002726", "C0002728", "C0002732", "C0002736", "C0002743", "C0002744", "C0002752", "C0002753", "C0002758", "C0002759", "C0002760", "C0002763", "C0002766", "C0002771", "C0002772", "C0002776", "C0002778", "C0002792", "C0002793", "C0002795", "C0002797", "C0002804", "C0002823", "C0002824", "C0002826", "C0002842", "C0002844", "C0002854", "C0002860", "C0002865", "C0002871", "C0002873", "C0002874", "C0002875", "C0002876", "C0002878", "C0002879", "C0002880", "C0002881", "C0002884", "C0002886", "C0002888", "C0002890", "C0002891", "C0002892", "C0002893", "C0002894", "C0002895", "C0002896", "C0002899", "C0002902", "C0002903", "C0002911", "C0002913", "C0002915", "C0002919", "C0002920", "C0002921", "C0002928", "C0002930", "C0002932", "C0002934", "C0002935", "C0002938", "C0002940", "C0002945", "C0002946", "C0002949", "C0002952", "C0002957", "C0002959", "C0002962", "C0002963", "C0002965", "C0002971", "C0002978", "C0002979", "C0002983", "C0002985", "C0002986", "C0002991", "C0002992", "C0002994", "C0003006", "C0003009", "C0003011", "C0003012", "C0003015", "C0003016", "C0003017", "C0003018", "C0003023", "C0003025", "C0003028", "C0003036", "C0003044", "C0003050", "C0003052", "C0003060", "C0003062", "C0003063", "C0003072", "C0003074", "C0003075", "C0003076", "C0003077", "C0003078", "C0003079", "C0003081", "C0003086", "C0003087", "C0003089", "C0003090", "C0003096", "C0003107", "C0003110", "C0003113", "C0003117", "C0003119", "C0003121", "C0003123", "C0003125", "C0003126", "C0003128", "C0003130", "C0003132", "C0003134", "C0003138", "C0003143", "C0003152", "C0003158", "C0003161", "C0003162", "C0003165", "C0003166", "C0003169", "C0003174", "C0003175", "C0003177", "C0003183", "C0003191", "C0003195", "C0003204", "C0003205", "C0003209", "C0003211", "C0003232", "C0003233", "C0003234", "C0003235", "C0003240", "C0003241", "C0003243", "C0003248", "C0003250", "C0003253", "C0003272", "C0003277", "C0003280", "C0003286", "C0003289", "C0003290", "C0003292", "C0003295", "C0003297", "C0003299", "C0003304", "C0003308", "C0003313", "C0003314", "C0003316", "C0003320", "C0003321", "C0003339", "C0003340", "C0003342", "C0003343", "C0003360", "C0003364", "C0003367", "C0003369", "C0003372", "C0003374", "C0003376", "C0003379", "C0003380", "C0003385", "C0003391", "C0003392", "C0003402", "C0003410", "C0003416", "C0003419", "C0003420", "C0003431", "C0003435", "C0003436", "C0003438", "C0003440", "C0003442", "C0003445", "C0003448", "C0003449", "C0003450", "C0003451", "C0003452", "C0003455", "C0003460", "C0003461", "C0003462", "C0003466", "C0003467", "C0003469", "C0003477", "C0003483", "C0003484", "C0003486", "C0003489", "C0003492", "C0003493", "C0003496", "C0003499", "C0003501", "C0003502", "C0003504", "C0003506", "C0003507", "C0003509", "C0003510", "C0003511", "C0003515", "C0003516", "C0003522", "C0003524", "C0003533", "C0003534", "C0003537", "C0003550", "C0003564", "C0003567", "C0003571", "C0003578", "C0003584", "C0003591", "C0003592", "C0003593", "C0003594", "C0003595", "C0003596", "C0003601", "C0003611", "C0003614", "C0003615", "C0003617", "C0003618", "C0003620", "C0003622", "C0003625", "C0003629", "C0003635", "C0003638", "C0003640", "C0003641", "C0003652", "C0003662", "C0003663", "C0003682", "C0003693", "C0003695", "C0003704", "C0003706", "C0003707", "C0003708", "C0003721", "C0003723", "C0003725", "C0003732", "C0003742", "C0003749", "C0003753", "C0003755", "C0003761", "C0003762", "C0003765", "C0003766", "C0003768", "C0003775", "C0003776", "C0003777", "C0003779", "C0003781", "C0003782", "C0003787", "C0003790", "C0003794", "C0003798", "C0003801", "C0003803", "C0003805", "C0003806", "C0003808", "C0003811", "C0003813", "C0003814", "C0003818", "C0003824", "C0003827", "C0003834", "C0003835", "C0003838", "C0003842", "C0003844", "C0003847", "C0003850", "C0003851", "C0003855", "C0003857", "C0003860", "C0003862", "C0003864", "C0003868", "C0003869", "C0003872", "C0003873", "C0003874", "C0003876", "C0003881", "C0003885", "C0003886", "C0003892", "C0003893", "C0003903", "C0003904", "C0003907", "C0003910", "C0003918", "C0003920", "C0003921", "C0003927", "C0003940", "C0003942", "C0003943", "C0003947", "C0003948", "C0003949", "C0003950", "C0003954", "C0003955", "C0003956", "C0003962", "C0003964", "C0003965", "C0003968", "C0003969", "C0003972", "C0003977", "C0003980", "C0003993", "C0003995", "C0003997", "C0003999", "C0004002", "C0004004", "C0004006", "C0004007", "C0004015", "C0004022", "C0004030", "C0004031", "C0004032", "C0004034", "C0004035", "C0004036", "C0004037", "C0004038", "C0004039", "C0004041", "C0004042", "C0004044", "C0004045", "C0004047", "C0004048", "C0004052", "C0004057", "C0004058", "C0004063", "C0004083", "C0004093", "C0004095", "C0004096", "C0004099", "C0004106", "C0004110", "C0004112", "C0004114", "C0004120", "C0004134", "C0004135", "C0004138", "C0004144", "C0004146", "C0004147", "C0004149", "C0004153", "C0004155", "C0004158", "C0004161", "C0004168", "C0004169", "C0004170", "C0004185", "C0004187", "C0004234", "C0004235", "C0004237", "C0004238", "C0004239", "C0004245", "C0004247", "C0004259", "C0004261", "C0004266", "C0004268", "C0004269", "C0004271", "C0004277", "C0004286", "C0004290", "C0004292", "C0004293", "C0004295", "C0004302", "C0004308", "C0004310", "C0004320", "C0004331", "C0004339", "C0004340", "C0004348", "C0004352", "C0004358", "C0004359", "C0004361", "C0004364", "C0004368", "C0004371", "C0004372", "C0004377", "C0004379", "C0004381"}

func TestUncompressed(t *testing.T) {
	f, err := os.Open("cui2vec_pretrained.csv")
	if err != nil {
		t.Fatal(err)
	}

	v, err := cui2vec.NewUncompressedEmbeddings(f, true)
	if err != nil {
		t.Fatal(err)
	}

	s, err := v.Similar("C0000052")
	if err != nil {
		t.Fatal(err)
	}
	fmt.Println(s[:5])
	return
}

func TestPrecomputed(t *testing.T) {
	f, err := os.Open("cui2vec_precomputed.bin")
	if err != nil {
		t.Fatal(err)
	}

	v, err := cui2vec.NewPrecomputedEmbeddings(f)
	if err != nil {
		t.Fatal(err)
	}

	s, err := v.Similar("C0000052")
	if err != nil {
		t.Fatal(err)
	}
	fmt.Println(s[:5])
	return
}

func BenchmarkUncompressed(b *testing.B) {
	f, err := os.Open("cui2vec_pretrained.csv")
	if err != nil {
		b.Fatal(err)
	}

	v, err := cui2vec.NewUncompressedEmbeddings(f, true)
	if err != nil {
		b.Fatal(err)
	}
	for _, c := range cuis {
		v.Similar(c)
	}
}

func BenchmarkPrecomputed(b *testing.B) {
	f, err := os.Open("cui2vec_precomputed.bin")
	if err != nil {
		b.Fatal(err)
	}

	v, err := cui2vec.NewPrecomputedEmbeddings(f)
	if err != nil {
		b.Fatal(err)
	}
	for _, c := range cuis {
		v.Similar(c)
	}
}
